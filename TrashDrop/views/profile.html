<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>Profile & Settings</title>
    
    <!-- Load AppConfig first for configuration-driven rendering -->
    <script src="/js/config/app-config.js"></script>
    <script src="/js/config/config-loader.js"></script>
    
    <!-- Conditional title and meta description will be set by script -->
    <meta name="description" content="">
    <link rel="manifest" href="/manifest.json">
    
    <!-- Local styles that don't depend on CDN -->
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/accessibility.css">
    <link rel="stylesheet" href="/css/navbar-fix.css">
    <link rel="stylesheet" href="/css/hide-emergency-logout.css">
    <link rel="stylesheet" href="/css/responsive-enhancements.css">
    <link rel="stylesheet" href="/css/device-optimizations.css">
    <link rel="stylesheet" href="/css/navbar-content-fix.css">
    <link rel="stylesheet" href="/css/dark-theme.css">
    
    <script>
        // Initialize page configuration
        async function initPageConfig() {
            try {
                // Initialize AppConfig if not already done
                if (!window.AppConfig || !window.AppConfig.initialized) {
                    await window.AppConfig.initialize();
                }
                
                // Get app name from config
                const appName = window.AppConfig.get('app.name') || 'TrashDrop';
                
                // Set page title
                const pageTitle = `Profile & Settings - ${appName}`;
                document.title = pageTitle;
                
                // Set meta description
                const metaDescription = window.AppConfig.get('ui.profilePage.metaDescription') || 
                    `${appName} profile and account settings - Manage your personal information, preferences, notifications, and security settings`;
                document.querySelector('meta[name="description"]').setAttribute('content', metaDescription);
                
                // Set theme color
                const themeColor = window.AppConfig.get('app.themeColor') || '#4CAF50';
                const metaThemeColor = document.createElement('meta');
                metaThemeColor.setAttribute('name', 'theme-color');
                metaThemeColor.setAttribute('content', themeColor);
                document.head.appendChild(metaThemeColor);
                
                // Load external CSS from CDN
                await loadExternalCSS();
                
            } catch (error) {
                console.error('Error initializing page config:', error);
                
                // Fallback for critical elements if configuration fails
                if (!document.title || document.title === 'Profile & Settings') {
                    document.title = 'Profile & Settings - TrashDrop';
                }
                
                if (!document.querySelector('meta[name="description"]').getAttribute('content')) {
                    document.querySelector('meta[name="description"]').setAttribute(
                        'content', 
                        'TrashDrop profile and account settings - Manage your personal information, preferences, notifications, and security settings'
                    );
                }
                
                // Ensure theme color is set
                if (!document.querySelector('meta[name="theme-color"]')) {
                    const metaThemeColor = document.createElement('meta');
                    metaThemeColor.setAttribute('name', 'theme-color');
                    metaThemeColor.setAttribute('content', '#4CAF50');
                    document.head.appendChild(metaThemeColor);
                }
                
                // Load fallback CSS if needed
                loadFallbackCSS();
            }
        }
        
        // Load external CSS resources
        async function loadExternalCSS() {
            try {
                // Get CSS URLs from config
                const bootstrapCssUrl = window.AppConfig.get('resources.bootstrapCssUrl') || 
                    'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css';
                const bootstrapIconsCssUrl = window.AppConfig.get('resources.bootstrapIconsCssUrl') || 
                    'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css';
                
                // Load Bootstrap CSS
                const bootstrapCss = document.createElement('link');
                bootstrapCss.rel = 'stylesheet';
                bootstrapCss.href = bootstrapCssUrl;
                document.head.appendChild(bootstrapCss);
                
                // Load Bootstrap Icons CSS
                const bootstrapIconsCss = document.createElement('link');
                bootstrapIconsCss.rel = 'stylesheet';
                bootstrapIconsCss.href = bootstrapIconsCssUrl;
                document.head.appendChild(bootstrapIconsCss);
                
                return Promise.resolve();
            } catch (error) {
                console.error('Error loading external CSS:', error);
                return Promise.reject(error);
            }
        }
        
        // Fallback CSS loading if configuration fails
        function loadFallbackCSS() {
            if (!document.querySelector('link[href*="bootstrap.min.css"]')) {
                const bootstrapCss = document.createElement('link');
                bootstrapCss.rel = 'stylesheet';
                bootstrapCss.href = 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css';
                document.head.appendChild(bootstrapCss);
            }
            
            if (!document.querySelector('link[href*="bootstrap-icons.css"]')) {
                const bootstrapIconsCss = document.createElement('link');
                bootstrapIconsCss.rel = 'stylesheet';
                bootstrapIconsCss.href = 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css';
                document.head.appendChild(bootstrapIconsCss);
            }
        }
        
        // Initialize page as soon as script is loaded
        initPageConfig();
    </script>
</head>
<body class="d-flex flex-column min-vh-100">
    <!-- Navbar placeholder for dynamic insertion -->
    <div id="navbar-container"></div>
    
    <script>
        // Dynamically create navbar with AppConfig
        async function createNavbar() {
            try {
                // Initialize AppConfig if not already done
                if (!window.AppConfig || !window.AppConfig.initialized) {
                    await window.AppConfig.initialize();
                }
                
                // Get branding information
                const appName = window.AppConfig.get('app.name') || 'TrashDrop';
                const logoPath = window.AppConfig.get('app.logoPath') || '/images/logo.svg';
                const logoAlt = window.AppConfig.get('app.logoAlt') || `${appName} Logo`;
                const logoWidth = window.AppConfig.get('app.logoWidth') || 30;
                const logoHeight = window.AppConfig.get('app.logoHeight') || 30;
                const dashboardUrl = window.AppConfig.get('navigation.dashboardUrl') || '/dashboard';
                const profileUrl = window.AppConfig.get('navigation.profileUrl') || '/profile';
                const rewardsUrl = window.AppConfig.get('navigation.rewardsUrl') || '/rewards';
                
                // Get UI text
                const onlineText = window.AppConfig.get('ui.connectionStatus.onlineText') || 'Online';
                const pointsText = window.AppConfig.get('ui.rewards.pointsText') || 'points';
                const profileText = window.AppConfig.get('ui.navbar.profileText') || 'Profile';
                const darkModeText = window.AppConfig.get('ui.navbar.darkModeText') || 'Dark Mode';
                const emergencyLogoutText = window.AppConfig.get('ui.navbar.emergencyLogoutText') || 'Emergency Logout';
                const logoutText = window.AppConfig.get('ui.navbar.logoutText') || 'Logout';
                
                const navbarHtml = `
                    <nav class="navbar navbar-dark bg-success" role="navigation" aria-label="Main Navigation">
                        <div class="container">
                            <!-- Mobile view (simplified) -->
                            <div class="d-flex d-lg-none justify-content-between align-items-center w-100">
                                <a class="navbar-brand" href="${dashboardUrl}">
                                    <img src="${logoPath}" alt="${logoAlt}" width="${logoWidth}" height="${logoHeight}" class="d-inline-block align-top me-2">
                                    ${appName}
                                </a>
                                <div class="d-flex align-items-center">
                                    <span id="connection-status-mobile" class="badge text-bg-success me-2">${onlineText}</span>
                                    <span id="pickup-offline-indicator-mobile" class="badge rounded-pill text-bg-warning d-none">0</span>
                                    <a href="${rewardsUrl}" class="text-white me-3 text-decoration-none">
                                        <i class="bi bi-award-fill"></i>
                                        <span id="user-points-mobile">0</span>
                                    </a>
                                    <div class="dropdown">
                                        <button class="btn btn-sm btn-outline-light rounded-circle p-1" type="button" id="userDropdownMobile" data-bs-toggle="dropdown" aria-expanded="false">
                                            <i class="bi bi-person-circle"></i>
                                        </button>
                                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdownMobile">
                                            <li><a class="dropdown-item" href="${profileUrl}"><i class="bi bi-person me-2"></i>${profileText}</a></li>
                                            <li><a class="dropdown-item" href="#" id="toggle-theme-mobile"><i class="bi bi-moon me-2"></i>${darkModeText}</a></li>
                                            <li><hr class="dropdown-divider"></li>
                                            <li><a class="dropdown-item text-danger" href="#" id="emergency-logout-mobile" data-bs-toggle="modal" data-bs-target="#emergencyLogoutModal"><i class="bi bi-exclamation-triangle me-2"></i>${emergencyLogoutText}</a></li>
                                            <li><a class="dropdown-item" href="#" id="logout-mobile"><i class="bi bi-box-arrow-right me-2"></i>${logoutText}</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                    
                            <!-- Desktop view -->
                            <div class="d-none d-lg-flex justify-content-between align-items-center w-100">
                                <a class="navbar-brand" href="${dashboardUrl}">
                                    <img src="${logoPath}" alt="${logoAlt}" width="${logoWidth}" height="${logoHeight}" class="d-inline-block align-top me-2">
                                    ${appName}
                                </a>
                                <div class="d-flex align-items-center">
                                    <span id="connection-status" class="badge text-bg-success me-2">${onlineText}</span>
                                    <span id="pickup-offline-indicator" class="badge rounded-pill text-bg-warning d-none">0</span>
                                    <a href="${rewardsUrl}" class="text-white me-3 text-decoration-none">
                                        <i class="bi bi-award-fill me-1"></i>
                                        <span id="user-points">0</span> ${pointsText}
                                    </a>
                                    <div class="dropdown">
                                        <button class="btn btn-outline-light dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                            <i class="bi bi-person-circle me-1"></i>
                                            <span id="user-name">User</span>
                                        </button>
                                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                                            <li><a class="dropdown-item" href="${profileUrl}"><i class="bi bi-person me-2"></i>${profileText}</a></li>
                                            <li><a class="dropdown-item" href="#" id="toggle-theme"><i class="bi bi-moon me-2"></i>${darkModeText}</a></li>
                                            <li><hr class="dropdown-divider"></li>
                                            <li><a class="dropdown-item text-danger" href="#" id="emergency-logout" data-bs-toggle="modal" data-bs-target="#emergencyLogoutModal"><i class="bi bi-exclamation-triangle me-2"></i>${emergencyLogoutText}</a></li>
                                            <li><a class="dropdown-item" href="#" id="logout"><i class="bi bi-box-arrow-right me-2"></i>${logoutText}</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </nav>
                `;
                
                // Insert navbar into the page
                const navbarContainer = document.getElementById('navbar-container');
                if (navbarContainer) {
                    navbarContainer.innerHTML = navbarHtml;
                }
            } catch (error) {
                console.error('Error creating navbar:', error);
                
                // Fallback to simple navbar if configuration fails
                const navbarContainer = document.getElementById('navbar-container');
                if (navbarContainer) {
                    navbarContainer.innerHTML = `
                        <nav class="navbar navbar-dark bg-success" role="navigation" aria-label="Main Navigation">
                            <div class="container">
                                <a class="navbar-brand" href="/dashboard">
                                    <img src="/images/logo.svg" alt="TrashDrop Logo" width="30" height="30" class="d-inline-block align-top me-2">
                                    TrashDrop
                                </a>
                                <div class="d-flex align-items-center">
                                    <div class="dropdown">
                                        <button class="btn btn-outline-light dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                            <i class="bi bi-person-circle me-1"></i>
                                            <span id="user-name">User</span>
                                        </button>
                                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                                            <li><a class="dropdown-item" href="/profile"><i class="bi bi-person me-2"></i>Profile</a></li>
                                            <li><a class="dropdown-item" href="#" id="logout"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    `;
                }
            }
        }
        
        // Initialize navbar when DOM is ready
        document.addEventListener('DOMContentLoaded', createNavbar);
    </script>
    <!-- Navbar is now dynamically generated by the script above -->

    <div class="container py-3">
        <h1 class="mb-3 fs-4 fw-bold">Profile & Settings</h1>

        <!-- Profile Navigation Tabs -->
        <ul class="nav nav-tabs mb-4" id="profileTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="personal-tab" data-bs-toggle="tab" data-bs-target="#personal" type="button" role="tab" aria-controls="personal" aria-selected="true">Personal Info</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="locations-tab" data-bs-toggle="tab" data-bs-target="#locations" type="button" role="tab" aria-controls="locations" aria-selected="false">Locations</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="preferences-tab" data-bs-toggle="tab" data-bs-target="#preferences" type="button" role="tab" aria-controls="preferences" aria-selected="false">Preferences</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="notifications-tab" data-bs-toggle="tab" data-bs-target="#notifications" type="button" role="tab" aria-controls="notifications" aria-selected="false">Notifications</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="security-tab" data-bs-toggle="tab" data-bs-target="#security" type="button" role="tab" aria-controls="security" aria-selected="false">Security</button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="profileTabsContent">
            <!-- Personal Info Tab -->
            <div class="tab-pane fade show active" id="personal" role="tabpanel" aria-labelledby="personal-tab">
                <div class="card border-0 shadow-sm rounded-3 mb-4">
                    <div class="card-body p-4">
                        <div class="row">
                            <div class="col-md-4 mb-4 mb-md-0">
                                <div class="text-center">
                                    <div class="position-relative d-inline-block">
                                        <div class="avatar-container mb-3 mx-auto rounded-circle overflow-hidden bg-light" style="width: 150px; height: 150px;">
                                            <img id="avatar-preview" src="/images/default-avatar.png" alt="Profile Picture" class="img-fluid">
                                        </div>
                                        <button class="btn btn-sm btn-primary position-absolute bottom-0 end-0" id="change-avatar">
                                            <i class="bi bi-camera"></i>
                                        </button>
                                    </div>
                                    <input type="file" id="avatar-upload" class="d-none" accept="image/*">
                                    <div class="mt-2">
                                        <h5 id="profile-full-name" class="mb-1">User Name</h5>
                                        <span class="text-muted" id="profile-member-since">Member since: Jan 2025</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <form id="personal-info-form">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label for="first_name" class="form-label">First Name</label>
                                            <input type="text" class="form-control" id="first_name" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="last_name" class="form-label">Last Name</label>
                                            <input type="text" class="form-control" id="last_name" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="email" class="form-label">Email Address</label>
                                            <input type="email" class="form-control" id="email" required readonly>
                                            <div class="form-text">Email address cannot be changed</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="phone" class="form-label">Phone Number</label>
                                            <input type="tel" class="form-control" id="phone" required>
                                        </div>
                                        <div class="col-12">
                                            <label for="address" class="form-label">Address</label>
                                            <input type="text" class="form-control" id="address" required>
                                        </div>
                                        <div class="col-12 d-grid d-md-flex justify-content-md-end mt-4">
                                            <button type="submit" class="btn btn-success" id="save-personal-info">
                                                <i class="bi bi-save me-2"></i>Save Changes
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Locations Tab -->
            <div class="tab-pane fade" id="locations" role="tabpanel" aria-labelledby="locations-tab">
                <div class="card border-0 shadow-sm rounded-3 mb-4">
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h5 class="mb-0">Saved Locations</h5>
                            <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addLocationModal">
                                <i class="bi bi-plus-lg me-1"></i> Add New Location
                            </button>
                        </div>
                        
                        <!-- Saved locations list -->
                        <div id="saved-locations-container" class="mb-4">
                            <div class="alert alert-info" id="no-locations-message" style="display:none;">
                                <i class="bi bi-info-circle me-2"></i> You don't have any saved locations yet. Add a location to use it for pickups.
                            </div>
                            
                            <div class="list-group" id="saved-locations-list">
                                <!-- Locations will be dynamically populated here -->
                            </div>
                        </div>
                        
                        <div class="alert alert-light border">
                            <i class="bi bi-lightbulb me-2"></i> <strong>Tip:</strong> Save locations you use frequently to quickly select them when requesting pickups.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Preferences Tab -->
            <div class="tab-pane fade" id="preferences" role="tabpanel" aria-labelledby="preferences-tab">
                <div class="card border-0 shadow-sm rounded-3 mb-4">
                    <div class="card-body p-4">
                        <form id="preferences-form">
                            <div class="mb-4">
                                <h5 class="mb-3">Theme</h5>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="dark_mode">
                                    <label class="form-check-label" for="dark_mode">Dark Mode</label>
                                    <div class="form-text">Enable dark theme for better viewing in low light</div>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h5 class="mb-3">Language</h5>
                                <select class="form-select" id="language">
                                    <option value="en">English (US)</option>
                                    <option value="es">Español</option>
                                    <option value="fr">Français</option>
                                    <option value="de">Deutsch</option>
                                </select>
                                <div class="form-text">Select your preferred language for the application</div>
                            </div>
                            
                            <div class="mb-4">
                                <h5 class="mb-3">Accessibility</h5>
                                <div class="form-check form-switch mb-2">
                                    <input class="form-check-input" type="checkbox" id="high_contrast">
                                    <label class="form-check-label" for="high_contrast">High Contrast</label>
                                </div>
                                <div class="form-check form-switch mb-2">
                                    <input class="form-check-input" type="checkbox" id="large_text">
                                    <label class="form-check-label" for="large_text">Larger Text</label>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="reduce_motion">
                                    <label class="form-check-label" for="reduce_motion">Reduce Motion</label>
                                </div>
                            </div>

                            <div class="col-12 d-grid d-md-flex justify-content-md-end mt-4">
                                <button type="submit" class="btn btn-success" id="save-preferences">
                                    <i class="bi bi-save me-2"></i>Save Preferences
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Notifications Tab -->
            <div class="tab-pane fade" id="notifications" role="tabpanel" aria-labelledby="notifications-tab">
                <div class="card border-0 shadow-sm rounded-3 mb-4">
                    <div class="card-body p-4">
                        <form id="notifications-form">
                            <div class="mb-4">
                                <h5 class="mb-3">Push Notifications</h5>
                                <div class="form-check form-switch mb-2">
                                    <input class="form-check-input" type="checkbox" id="enable_push" checked>
                                    <label class="form-check-label" for="enable_push">Enable Push Notifications</label>
                                </div>
                                
                                <div class="ms-4 mt-3">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="notify_pickup_reminders" checked>
                                        <label class="form-check-label" for="notify_pickup_reminders">Pickup Reminders</label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="notify_bag_scans" checked>
                                        <label class="form-check-label" for="notify_bag_scans">Bag Scans</label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="notify_points_earned" checked>
                                        <label class="form-check-label" for="notify_points_earned">Points Earned</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="notify_news" checked>
                                        <label class="form-check-label" for="notify_news">News & Updates</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h5 class="mb-3">Email Notifications</h5>
                                <div class="form-check form-switch mb-2">
                                    <input class="form-check-input" type="checkbox" id="enable_email" checked>
                                    <label class="form-check-label" for="enable_email">Enable Email Notifications</label>
                                </div>
                                
                                <div class="ms-4 mt-3">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="email_pickup_summary" checked>
                                        <label class="form-check-label" for="email_pickup_summary">Weekly Pickup Summary</label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="email_points_summary" checked>
                                        <label class="form-check-label" for="email_points_summary">Monthly Points Summary</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="email_special_offers">
                                        <label class="form-check-label" for="email_special_offers">Special Offers & Promotions</label>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 d-grid d-md-flex justify-content-md-end mt-4">
                                <button type="submit" class="btn btn-success" id="save-notifications">
                                    <i class="bi bi-save me-2"></i>Save Notification Settings
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Security Tab -->
            <div class="tab-pane fade" id="security" role="tabpanel" aria-labelledby="security-tab">
                <div class="card border-0 shadow-sm rounded-3 mb-4">
                    <div class="card-body p-4">
                        <div class="mb-4">
                            <h5 class="mb-3">Change Password</h5>
                            <form id="change-password-form">
                                <div class="mb-3">
                                    <label for="current_password" class="form-label">Current Password</label>
                                    <input type="password" class="form-control" id="current_password" required>
                                </div>
                                <div class="mb-3">
                                    <label for="new_password" class="form-label">New Password</label>
                                    <input type="password" class="form-control" id="new_password" required>
                                    <div class="progress mt-2" style="height: 5px;">
                                        <div id="password-strength-meter" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <small id="password-strength-text" class="form-text">Password strength: Too weak</small>
                                </div>
                                <div class="mb-3">
                                    <label for="confirm_password" class="form-label">Confirm New Password</label>
                                    <input type="password" class="form-control" id="confirm_password" required>
                                </div>
                                <div class="d-grid d-md-flex justify-content-md-end">
                                    <button type="submit" class="btn btn-primary" id="change-password-btn">
                                        <i class="bi bi-lock-fill me-2"></i>Update Password
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <hr class="my-4">
                        
                        <div class="mb-4">
                            <h5 class="mb-3">Login Sessions</h5>
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <div>
                                    <p class="mb-0"><strong>Current Device</strong></p>
                                    <small class="text-muted" id="current-device">Chrome on macOS • Active now</small>
                                </div>
                                <span class="badge bg-success">Active</span>
                            </div>
                            <div class="d-grid d-md-flex justify-content-md-end">
                                <button type="button" class="btn btn-outline-danger" id="logout-all-devices">
                                    <i class="bi bi-box-arrow-right me-2"></i>Logout from All Devices
                                </button>
                            </div>
                        </div>
                        
                        <hr class="my-4">
                        
                        <div>
                            <h5 class="mb-3">Account Actions</h5>
                            <div class="d-grid gap-2 d-md-flex">
                                <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
                                    <i class="bi bi-trash me-2"></i>Delete Account
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Bottom Navigation -->
    <div class="d-lg-none mobile-bottom-nav shadow-lg">
        <a href="/dashboard" class="mobile-nav-item">
            <i class="bi bi-house-door"></i>
            <span>Home</span>
        </a>
        <a href="/scan" class="mobile-nav-item">
            <i class="bi bi-qr-code-scan"></i>
            <span>Scan</span>
        </a>
        <a href="/schedule-pickup" class="mobile-nav-item">
            <i class="bi bi-calendar"></i>
            <span>Schedule</span>
        </a>
        <a href="/rewards" class="mobile-nav-item">
            <i class="bi bi-trophy"></i>
            <span>Rewards</span>
        </a>
        <a href="/profile" class="mobile-nav-item active">
            <i class="bi bi-person"></i>
            <span>Profile</span>
        </a>
    </div>

    <!-- Delete Account Modal -->
    <div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-labelledby="deleteAccountModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="deleteAccountModalLabel">Delete Account</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                        <strong>Warning:</strong> This action cannot be undone.
                    </div>
                    <p>Deleting your account will:</p>
                    <ul>
                        <li>Remove all your personal information</li>
                        <li>Delete your pickup history and reports</li>
                        <li>Cancel any scheduled pickups</li>
                        <li>Remove all your earned points</li>
                    </ul>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="confirm-delete">
                        <label class="form-check-label" for="confirm-delete">
                            I understand that this action is permanent
                        </label>
                    </div>
                    <div class="mb-3">
                        <label for="delete-password" class="form-label">Enter your password to confirm</label>
                        <input type="password" class="form-control" id="delete-password" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirm-delete-btn" disabled>
                        <i class="bi bi-trash me-2"></i>Delete My Account
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Emergency Logout Modal -->
    <div class="modal fade" id="emergencyLogoutModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">Emergency Logout</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>This will immediately log you out of all devices and clear all local data. Use this if you believe your account security is compromised.</p>
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                        <strong>Warning:</strong> Any unsaved changes will be lost.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirm-emergency-logout">
                        <i class="bi bi-shield-exclamation me-2"></i>Emergency Logout
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Location Modal -->
    <div class="modal fade" id="addLocationModal" tabindex="-1" aria-labelledby="addLocationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="addLocationModalLabel">Add New Location</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="location-form">
                        <input type="hidden" id="location-id">
                        <div class="mb-3">
                            <label for="location-name" class="form-label">Location Name</label>
                            <input type="text" class="form-control" id="location-name" placeholder="Home, Work, etc." required>
                            <div class="form-text">Give this location a name you'll recognize</div>
                        </div>
                        <div class="mb-3">
                            <label for="location-address" class="form-label">Address</label>
                            <input type="text" class="form-control" id="location-address" placeholder="Enter address" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Select on Map</label>
                            <div id="location-map" style="height: 300px; border-radius: 8px; margin-bottom: 10px;"></div>
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted">
                                    <span id="location-lat">0.000000</span>, 
                                    <span id="location-lng">0.000000</span>
                                </small>
                                <button type="button" class="btn btn-sm btn-outline-primary" id="use-my-location">
                                    <i class="bi bi-geo-alt me-1"></i> Use Current Location
                                </button>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="location-notes" class="form-label">Notes (Optional)</label>
                            <textarea class="form-control" id="location-notes" rows="2" placeholder="Any special instructions or details"></textarea>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="location-default">
                            <label class="form-check-label" for="location-default">
                                Set as default location
                            </label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" id="save-location">Save Location</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Location Confirmation Modal -->
    <div class="modal fade" id="deleteLocationModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">Delete Location</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this location?</p>
                    <p id="delete-location-name" class="fw-bold"></p>
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        This action cannot be undone.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirm-delete-location">Delete</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="toast-container"></div>
    </div>

    <!-- Footer placeholder (will be dynamically populated by JavaScript) -->
    <div id="footer-container"></div>
    
    <script>
        // Dynamically load JavaScript resources
        async function loadScripts() {
            try {
                // Initialize AppConfig if not already initialized
                if (!window.AppConfig || !window.AppConfig.initialized) {
                    await window.AppConfig.initialize();
                }
                
                // Get script URLs from config
                const bootstrapJsUrl = window.AppConfig.get('resources.bootstrapJsUrl') || 
                    'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js';
                const supabaseUrl = window.AppConfig.get('resources.supabaseJsUrl') || 
                    'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js';
                const leafletCssUrl = window.AppConfig.get('resources.leafletCssUrl') || 
                    'https://unpkg.com/leaflet@1.9.3/dist/leaflet.css';
                const leafletJsUrl = window.AppConfig.get('resources.leafletJsUrl') || 
                    'https://unpkg.com/leaflet@1.9.3/dist/leaflet.js';
                
                // Load Bootstrap JS
                const bootstrapScript = document.createElement('script');
                bootstrapScript.src = bootstrapJsUrl;
                document.body.appendChild(bootstrapScript);
                
                // Wait for Bootstrap to load before loading other scripts
                await new Promise(resolve => bootstrapScript.onload = resolve);
                
                // Load Theme Switcher scripts
                const themeSwitcherScript = document.createElement('script');
                themeSwitcherScript.src = '/js/theme-switcher.js';
                document.body.appendChild(themeSwitcherScript);
                
                const themeSwitcherEnhancedScript = document.createElement('script');
                themeSwitcherEnhancedScript.src = '/js/theme-switcher-enhanced.js';
                document.body.appendChild(themeSwitcherEnhancedScript);
                
                // Load Leaflet CSS
                const leafletCss = document.createElement('link');
                leafletCss.rel = 'stylesheet';
                leafletCss.href = leafletCssUrl;
                document.head.appendChild(leafletCss);
                
                // Load Leaflet JS
                const leafletScript = document.createElement('script');
                leafletScript.src = leafletJsUrl;
                document.body.appendChild(leafletScript);
                
                // Load Supabase
                const supabaseScript = document.createElement('script');
                supabaseScript.src = supabaseUrl;
                document.body.appendChild(supabaseScript);
                
                // Wait for critical dependencies to load
                await Promise.all([
                    new Promise(resolve => leafletScript.onload = resolve),
                    new Promise(resolve => supabaseScript.onload = resolve)
                ]);
                
                // Load custom scripts in sequence to maintain execution order
                const customScripts = [
                    '/js/auth.js',
                    '/js/offline-sync.js',
                    '/js/remove-emergency-logout.js',
                    '/js/profile.js',
                    '/js/profile-notifications.js',
                    '/js/profile-preferences.js',
                    '/js/profile-locations.js',
                    '/js/pwa-fullscreen.js',
                    '/js/mobile-nav.js'
                ];
                
                for (const scriptSrc of customScripts) {
                    const script = document.createElement('script');
                    script.src = scriptSrc;
                    document.body.appendChild(script);
                    
                    // Wait for each script to load to maintain execution order
                    await new Promise(resolve => {
                        script.onload = resolve;
                        // If script fails to load after 3 seconds, continue anyway
                        setTimeout(resolve, 3000);
                    });
                }
                
                // Create footer after scripts are loaded
                createFooter();
                
            } catch (error) {
                console.error('Error loading scripts:', error);
                
                // Fallback - load critical scripts directly
                if (!document.querySelector('script[src="/js/auth.js"]')) {
                    const authScript = document.createElement('script');
                    authScript.src = '/js/auth.js';
                    document.body.appendChild(authScript);
                }
                
                if (!document.querySelector('script[src="/js/profile.js"]')) {
                    const profileScript = document.createElement('script');
                    profileScript.src = '/js/profile.js';
                    document.body.appendChild(profileScript);
                }
                
                // Create footer even if scripts fail
                createFooter();
            }
        }
        
        // Create footer with AppConfig values
        async function createFooter() {
            try {
                if (!window.AppConfig || !window.AppConfig.initialized) {
                    await window.AppConfig.initialize();
                }
                
                // Get branding information
                const appName = window.AppConfig.get('app.name') || 'TrashDrop';
                const logoPath = window.AppConfig.get('app.footerLogoPath') || '/images/logo-white.svg';
                const logoAlt = window.AppConfig.get('app.logoAlt') || `${appName} Logo`;
                const logoWidth = window.AppConfig.get('app.logoWidth') || 30;
                const logoHeight = window.AppConfig.get('app.logoHeight') || 30;
                const currentYear = new Date().getFullYear();
                const copyright = window.AppConfig.get('app.copyright') || `&copy; ${currentYear} ${appName}. All rights reserved.`;
                
                // Get footer links
                const aboutUrl = window.AppConfig.get('navigation.aboutUrl') || '/about';
                const privacyUrl = window.AppConfig.get('navigation.privacyUrl') || '/privacy';
                const termsUrl = window.AppConfig.get('navigation.termsUrl') || '/terms';
                const contactUrl = window.AppConfig.get('navigation.contactUrl') || '/contact';
                
                const aboutText = window.AppConfig.get('ui.footer.aboutText') || 'About';
                const privacyText = window.AppConfig.get('ui.footer.privacyText') || 'Privacy Policy';
                const termsText = window.AppConfig.get('ui.footer.termsText') || 'Terms';
                const contactText = window.AppConfig.get('ui.footer.contactText') || 'Contact';
                
                const footerHtml = `
                    <footer class="mt-auto py-4 bg-dark text-white">
                        <div class="container">
                            <div class="row align-items-center gy-3">
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center">
                                        <img src="${logoPath}" alt="${logoAlt}" width="${logoWidth}" height="${logoHeight}" class="me-3">
                                        <div>
                                            <h5 class="mb-0">${appName}</h5>
                                            <small>${copyright}</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <ul class="nav justify-content-md-end justify-content-center">
                                        <li class="nav-item"><a href="${aboutUrl}" class="nav-link px-2 text-white">${aboutText}</a></li>
                                        <li class="nav-item"><a href="${privacyUrl}" class="nav-link px-2 text-white">${privacyText}</a></li>
                                        <li class="nav-item"><a href="${termsUrl}" class="nav-link px-2 text-white">${termsText}</a></li>
                                        <li class="nav-item"><a href="${contactUrl}" class="nav-link px-2 text-white">${contactText}</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </footer>
                `;
                
                // Insert footer into the page
                const footerContainer = document.getElementById('footer-container');
                if (footerContainer) {
                    footerContainer.innerHTML = footerHtml;
                }
            } catch (error) {
                console.error('Error creating footer:', error);
                
                // Fallback to default footer if configuration fails
                const footerContainer = document.getElementById('footer-container');
                if (footerContainer) {
                    footerContainer.innerHTML = `
                        <footer class="mt-auto py-4 bg-dark text-white">
                            <div class="container">
                                <div class="row align-items-center gy-3">
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-center">
                                            <img src="/images/logo-white.svg" alt="TrashDrop Logo" width="30" height="30" class="me-3">
                                            <div>
                                                <h5 class="mb-0">TrashDrop</h5>
                                                <small>&copy; ${new Date().getFullYear()} TrashDrop. All rights reserved.</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <ul class="nav justify-content-md-end justify-content-center">
                                            <li class="nav-item"><a href="/about" class="nav-link px-2 text-white">About</a></li>
                                            <li class="nav-item"><a href="/privacy" class="nav-link px-2 text-white">Privacy Policy</a></li>
                                            <li class="nav-item"><a href="/terms" class="nav-link px-2 text-white">Terms</a></li>
                                            <li class="nav-item"><a href="/contact" class="nav-link px-2 text-white">Contact</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </footer>
                    `;
                }
            }
        }
        
        // Call script loader
        loadScripts();
    </script>
    
    <!-- Navigation components -->
    <script src="/js/mobile-nav.js"></script>
    <script src="/js/navbar.js"></script>
</body>
</html>
